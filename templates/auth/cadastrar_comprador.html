{% extends "base.html" %}

{% block title %}Seja um Comprador — AgroKongo{% endblock %}

{% block content %}
<div class="container py-4 py-lg-5 animate__animated animate__fadeIn">
    <div class="row justify-content-center">
        <div class="col-lg-11 col-xl-10">
            <div class="card bg-white rounded-5 shadow-lg overflow-hidden border-0">
                <div class="row g-0">

                    <div class="col-lg-5 d-none d-lg-flex p-5 flex-column justify-content-between text-white position-relative overflow-hidden"
                         style="background: linear-gradient(rgba(21, 128, 61, 0.88), rgba(2, 6, 23, 0.92)),
                                url('https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=800');
                                background-size: cover; background-position: center;">

                        <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10" style="background-image: url('https://www.transparenttextures.com/patterns/leaf.png');"></div>

                        <div class="position-relative animate__animated animate__fadeInLeft">
                            <div class="mb-4">
                                <span class="badge bg-white text-success px-3 py-2 rounded-pill fw-800 shadow-sm">
                                    <i class="bi bi-cart-check-fill me-1"></i> MODO COMPRADOR
                                </span>
                            </div>
                            <h2 class="display-5 fw-900 mb-4" style="letter-spacing: -2px; line-height: 0.9;">
                                Aceda direto à <br><span class="text-success-light">fonte.</span>
                            </h2>
                            <ul class="list-unstyled">
                                <li class="mb-4 d-flex gap-3 animate__animated animate__fadeInLeft animate__delay-1s">
                                    <div class="icon-circle-sm">
                                        <i class="bi bi-lightning-charge-fill"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-800 m-0">Sem Intermediários</h6>
                                        <p class="small opacity-75 m-0">Negocie direto com quem planta e colhe.</p>
                                    </div>
                                </li>
                                <li class="mb-4 d-flex gap-3 animate__animated animate__fadeInLeft animate__delay-2s">
                                    <div class="icon-circle-sm">
                                        <i class="bi bi-shield-shaded"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-800 m-0">Pagamento Protegido</h6>
                                        <p class="small opacity-75 m-0">O produtor só recebe após a sua confirmação.</p>
                                    </div>
                                </li>
                                <li class="mb-4 d-flex gap-3 animate__animated animate__fadeInLeft animate__delay-3s">
                                    <div class="icon-circle-sm">
                                        <i class="bi bi-truck"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-800 m-0">Logística Facilitada</h6>
                                        <p class="small opacity-75 m-0">Acompanhe o trajeto da sua mercadoria.</p>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <div class="bg-white bg-opacity-10 p-4 rounded-4 backdrop-blur border border-white border-opacity-10 position-relative animate__animated animate__fadeInUp">
                            <i class="bi bi-quote fs-2 position-absolute top-0 start-0 mt-2 ms-2 opacity-25"></i>
                            <p class="small m-0 opacity-90 fw-600 fs-6 italic px-3">
                                "O AgroKongo facilitou a nossa logística para o restaurante em Luanda."
                            </p>
                            <footer class="text-white small mt-2 opacity-60 fw-700 ps-3">— Dona Maria, Restaurante Sabores</footer>
                        </div>
                    </div>

                    <div class="col-lg-7 p-4 p-md-5 bg-white">
                        <div class="mb-5 text-center text-lg-start">
                            <h2 class="fw-900 text-dark mb-1 h3" style="letter-spacing: -1px;">Criar Conta</h2>
                            <p class="text-muted fw-600">Junte-se à maior rede agrícola de Angola.</p>
                        </div>

                        <form method="POST" action="{{ url_for('auth.cadastro', tipo='comprador') }}" id="formComprador">

                            <div class="mb-4">
                                <label class="label-caps mb-2">Contacto de Negócio (WhatsApp)</label>
                                <div class="input-group-modern">
                                    <span class="fw-900 text-success border-end pe-3 me-2">+244</span>
                                    <input type="tel" name="telemovel" class="form-control-modern"
                                           placeholder="9xxxxxxxx" required pattern="9[0-9]{8}" maxlength="9">
                                    <i class="bi bi-whatsapp text-muted opacity-50"></i>
                                </div>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label class="label-caps mb-2">Senha</label>
                                    <div class="input-group-modern">
                                        <i class="bi bi-shield-lock text-success me-2"></i>
                                        <input type="password" name="senha" id="senha" class="form-control-modern"
                                               placeholder="Mínimo 6" required minlength="6">
                                    </div>
                                    <div class="strength-meter mt-2"><div id="strength-bar" class="s-bar"></div></div>
                                </div>
                                <div class="col-md-6">
                                    <label class="label-caps mb-2">Confirmar Senha</label>
                                    <div class="input-group-modern">
                                        <i class="bi bi-check2-circle text-success me-2"></i>
                                        <input type="password" name="confirmar_senha" id="confirmar_senha"
                                               class="form-control-modern" placeholder="Repita" required>
                                    </div>
                                </div>
                            </div>

                            <div class="auth-divider-text py-4">Localização de Compra</div>

                            <div class="mb-5">
                                <label class="label-caps mb-2">Onde opera comercialmente?</label>
                                <div class="input-group-modern select-wrapper">
                                    <i class="bi bi-geo-alt text-success me-2"></i>
                                    <select name="provincia" required class="form-select-modern">
                                        <option value="" disabled selected>Selecione a Província</option>
                                        {% for p in provincias %}
                                            <option value="{{ p.id }}">{{ p.nome }}</option>
                                        {% endfor %}
                                    </select>
                                    <i class="bi bi-chevron-down ms-auto text-muted"></i>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success w-100 py-3 rounded-4 shadow-lg fw-900 fs-5 mb-4 hover-up transition-all border-0">
                                Finalizar Registo <i class="bi bi-arrow-right ms-2"></i>
                            </button>

                            <p class="text-center text-muted fw-700">
                                Já tem conta?
                                <a href="{{ url_for('auth.login') }}" class="text-success fw-900 text-decoration-none ms-1 border-bottom border-success border-2">Entrar Agora</a>
                            </p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root { --green-agrokongo: #15803d; }

    .label-caps { font-size: 0.68rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1.2px; color: #64748b; }
    .text-success-light { color: #86efac !important; }
    .backdrop-blur { backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }

    /* Estilo Moderno de Inputs */
    .input-group-modern {
        display: flex; align-items: center; background: #f8fafc; border: 2.5px solid #f1f5f9;
        border-radius: 18px; padding: 12px 18px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .input-group-modern:focus-within {
        border-color: var(--green-agrokongo);
        background: white;
        box-shadow: 0 12px 24px rgba(21, 128, 61, 0.08);
        transform: scale(1.01);
    }

    .form-control-modern { border: none; background: transparent; width: 100%; font-weight: 700; outline: none; color: #1e293b; font-size: 1rem; }
    .form-select-modern { border: none; background: transparent; width: 100%; font-weight: 700; outline: none; cursor: pointer; appearance: none; color: #1e293b; }

    /* Sidebar Icons */
    .icon-circle-sm {
        width: 38px; height: 38px; background: rgba(255,255,255,0.15);
        border-radius: 12px; display: flex; align-items: center;
        justify-content: center; font-size: 1.1rem; flex-shrink: 0;
    }

    /* Strength Meter */
    .strength-meter { height: 6px; background: #f1f5f9; border-radius: 10px; overflow: hidden; }
    .s-bar { height: 100%; width: 0; transition: all 0.5s ease; }

    /* Divider */
    .auth-divider-text { text-align: center; font-size: 0.75rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
    .auth-divider-text::before, .auth-divider-text::after { content: ""; flex: 1; height: 1.5px; background: #f1f5f9; }
    .auth-divider-text::before { margin-right: 20px; } .auth-divider-text::after { margin-left: 20px; }

    .hover-up:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(21, 128, 61, 0.25) !important; }
    .transition-all { transition: all 0.3s ease; }
</style>

<script>
    // Mágica no medidor de força
    const senhaInput = document.getElementById('senha');
    const bar = document.getElementById('strength-bar');

    senhaInput.addEventListener('input', () => {
        const val = senhaInput.value;
        let score = 0;
        if (val.length >= 6) score += 30;
        if (val.match(/[A-Z]/)) score += 35;
        if (val.match(/[0-9]/)) score += 35;

        bar.style.width = score + '%';
        if (score <= 30) bar.style.backgroundColor = '#ef4444';
        else if (score < 100) bar.style.backgroundColor = '#f59e0b';
        else bar.style.backgroundColor = '#15803d';
    });

    // Validação de correspondência
    document.getElementById('formComprador').onsubmit = function(e) {
        const s1 = document.getElementById('senha').value;
        const s2 = document.getElementById('confirmar_senha').value;
        if (s1 !== s2) {
            e.preventDefault();
            alert("As senhas não coincidem. Por favor, tente novamente.");
            return false;
        }
        return true;
    };
</script>
{% endblock %}